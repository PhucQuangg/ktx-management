<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments/head::head"></head>
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">
    <div th:replace="fragments/header::header"></div>

    <!-- =============================================== -->

    <!-- Left side column. contains the sidebar -->
    <div th:replace="fragments/sidebar::sidebar"></div>

    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Chào mừng đến với trang quản trị
            </h1>
            <ol class="breadcrumb">
                <li><a href="/admin"><i class="fa fa-dashboard"></i> Home</a></li>
            </ol>
        </section>

        <!-- Main content -->
        <section class="content">

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->



</div>
<!-- ./wrapper -->

<!-- jQuery 3 -->

<div th:replace="fragments/script::script"></div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        function parseJwt(token) {
            try {
                return JSON.parse(atob(token.split('.')[1]));
            } catch (e) {
                return null;
            }
        }

        const token = localStorage.getItem("token");
        if (token) {
            const decoded = parseJwt(token);
            if (decoded && decoded.username) {
                const elements = document.querySelectorAll(".usernameSpan");
                elements.forEach(el => {
                    el.innerText = decoded.username;
                });
            }
        }
    });

    function logout() {
        fetch("/api/auth/logout", {
            method: "POST",
            credentials: "include"
        })
            .then(res => {
                if (res.ok) {
                    localStorage.removeItem("token");
                    localStorage.removeItem("role");
                    window.location.href = "/login";
                } else {
                    alert("Logout failed: " + res.status);
                }
            })
            .catch(err => console.error(err));
    }
    const userMenu = document.getElementById("userMenu");
    const token = localStorage.getItem("token");

    if (token) {
        // Đã login
        userMenu.innerHTML = `
            <div class="pull-left">
                <a href="/profile" class="btn btn-default btn-flat">Profile</a>
            </div>
            <div class="pull-right">
                <a onclick="logout()" class="btn btn-default btn-flat">Sign out</a>
            </div>
        `;
    } else {
        // Chưa login
        userMenu.innerHTML = `
            <div class="text-center" style="width:100%">
                <a href="/login" class="btn btn-default btn-flat">Sign in</a>
            </div>
        `;
    }
</script>

</body>
</html>